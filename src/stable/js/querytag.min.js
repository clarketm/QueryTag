/*!
 * queryTag.js v1.0.0 (http://www.clarketravis.com)
 * Copyright 2015 Travis Clarke
 * Licensed under the MIT license
 */
;(function(c,e){var d=c.jQuery,b;d.fn.queryTag=function(g,u,i){var x=d.extend([],d.fn.queryTag.defaultViews,i),j=d.fn.queryTag.selectors,n=d.fn.queryTag.styles,l="https://cse.google.com/api/"+g+"/cse/"+u+"/queries/js",z=["overall","year","month","week","day"],m=[],y=d(j.$searchForm),q=d(j.$menuGroup),p=d(j.$buttonGroup),w=d(j.$selectGroup),h=d(j.$navIcon),o=d(j.$alertInfo),k=d(j.$alertEmpty),r=d(j.$alertError),f=n.button,t=n.category,v=n.color,s;switch(n.reload){case"img":s=d.fn.queryTag.reloadStyle.img.element();break;case"fontawesome":s=d.fn.queryTag.reloadStyle.fontawesome.element();break;case null:case false:case e:case"":s="";break;default:s=n.reload;break}k.html(function(A,B){return d.fn.queryTag.emptyText+B});r.html(function(A,B){return d.fn.queryTag.errorText+s+B});return this.each(function(){var N=d(this);N.hide();L();function L(){d.ajax({dataType:"json",url:d.fn.queryTag.pathToJSON,data:d.fn.queryTag.data,success:function(O){D(new a(N,O,t,v))},error:function(O,Q,P){console.group("There was a %s loading your category data",Q);console.error("Error: ",P);console.groupEnd();A()}})}function D(P){P.empty();var O={overall:d.ajax({url:l,jsonp:"callback",dataType:"jsonp",data:{view:z[0]},success:function(Q){P.render(z[0],Q)}}),year:d.ajax({url:l,jsonp:"callback",dataType:"jsonp",data:{view:"one_"+z[1]},success:function(Q){P.render(z[1],Q)}}),month:d.ajax({url:l,jsonp:"callback",dataType:"jsonp",data:{view:z[2]},success:function(Q){P.render(z[2],Q)}}),week:d.ajax({url:l,jsonp:"callback",dataType:"jsonp",data:{view:z[3]},success:function(Q){P.render(z[3],Q)}}),day:d.ajax({url:l,jsonp:"callback",dataType:"jsonp",data:{view:z[4]},success:function(Q){P.render(z[4],Q)}})};x.forEach(function(Q){m.push(O[Q])});d.when.apply(d,m).then(function(){N.show();F()},function(Q,S,R){console.group("There was a %s fetching your query data from Google",S);console.error("Error: ",R);console.groupEnd();A(P)})}function F(){var O=d(".label");O.each(function(){var P=d(this).attr("data-number");d(this).css("font-size",d.fn.queryTag.sizes[P])});B()}function B(){b=N.isotope({itemSelector:".label",filter:".overall",layoutMode:"packery",getSortData:{name:".name",number:"[data-number]",category:"[data-category]"},vertical:{horizontalAlignment:0}});H();M();I();E();K();J()}function H(){w.on("change","select",function(){var P=d(this);var O="."+P.val().toLowerCase();p.children("button").removeClass("active");C("packery","original-order",O,P)})}function M(){N.on("click",".label",function(R){R.preventDefault();var Q=d(this),P=Q.find(".name").text(),O=y.find("#search").length?y.find("#search"):y.find("input[type='search']").first();var S=d.Event("query.qt");S.tag=P;S.input=O;S.form=y;Q.trigger(S)})}function I(){b.on("layoutComplete",function(R,P){var O=P.length,Q;o.removeClass("alert-success");o.removeClass("alert-warning");if(O===0){p.children("button").prop("disabled",true);o.addClass("alert-warning").html("0 results found");k.slideDown(250)}else{p.children("button").prop("disabled",false);Q=(O===1)?"result":"results";o.addClass("alert-success").html(O+" "+Q+" found")}});o.css("display","inline-block")}function E(){var O=[];p.children("button").addClass(f);p.on("click","button",function(S){var R=d(this),P=R.attr("data-sort-value");if(S.ctrlKey||S.metaKey){R.toggleClass("active")}else{R.toggleClass("active");p.children("button").not(R).removeClass("active");O=[]}var Q=p.children(".active"),T=Q.length?"vertical":"packery";if(R.is(".active")){O.push(P)}else{O.splice(O.indexOf(P),1)}if(O.length===0){O.push("original-order")}G(T,O,R)})}function K(){h.append('<div class="icon"></div>');h.click(function(){var P=d(this);var O=p.children("button").is(".active");P.toggleClass("open");p.children("button").removeClass("active");G("packery",["original-order"],P,O);q.slideToggle(350,function(){P.is(".open")?P.trigger("shown.qt"):P.trigger("hidden.qt")})})}function A(O){r.slideDown();d("#refresh").on("click",function(){r.fadeOut(1400);d(this).children().rotate(720,{duration:1400,easing:"swing",complete:function(){O?D(O):L()}})})}function J(){b.isotope()}function G(R,O,Q,P){b.isotope({layoutMode:R,sortBy:O});if(Q.is(".navicon")){if(P){Q.trigger("unsort.qt")}return}d.inArray("original-order",O)?Q.trigger("sort.qt"):Q.trigger("unsort.qt")}function C(S,O,P,Q){k.hide();b.isotope({layoutMode:S,sortBy:O,filter:P});var R=d.Event("filter.qt");R.view=Q.val();Q.trigger(R)}})};d.fn.queryTag.defaultViews=["overall","year","month","week","day"];d.fn.queryTag.selectors={$searchForm:".searchable",$menuGroup:".collapsible",$buttonGroup:".sortable",$selectGroup:".filterable",$navIcon:".navicon",$alertInfo:"#alert-results",$alertEmpty:"#alert-empty",$alertError:"#alert-error"};d.fn.queryTag.styles={category:"general",button:"button-default",color:"label-default",reload:"img"};d.fn.queryTag.sizes=["1.5em","1.375em","1.25em","1.125em","1em","0.9375em","0.875em"];d.fn.queryTag.pathToJSON="dist/data/categories.json";d.fn.queryTag.data=null;d.fn.queryTag.emptyText="Sorry, no results found for your search.";d.fn.queryTag.errorText="Sorry! We are unable to retrieve the search queries at this time.";d.fn.queryTag.reloadStyle={img:{src:"dist/img/refresh.png",element:function(){return"<a id='refresh' href='#'><img src="+this.src+" alt='refresh'></a>"}},fontawesome:{size:"fa-2x",element:function(){return"<a id='refresh' title='refresh' href='#'><i class='fa fa-refresh "+this.size+"'></i></a>"}}};d.fn.rotate=function(j,i,k,f){var g=d.speed(i,k,f);var h=g.step;return this.each(function(l,m){g.complete=d.proxy(g.complete,m);g.step=function(n){d.style(m,"transform","rotate("+n+"deg)");if(h){return h.apply(m,arguments)}};d({deg:0}).animate({deg:j},g)})};var a=function(g,j,f,i){this.container=g;this.data=j;this.category=f;this.color=i;this.septiles=[];for(var h=1;h<=7;h++){this.septiles.push(100-((100/7)*h))}};a.prototype.empty=function(){this.container.empty()};a.prototype.render=function(n,k){var f=k.popularQueries.length;for(var j=0;j<f;j++){var o=d('<a href="#" class="label"><span class="name"></span></a>'),l=((f-(j+1)+0.5)/f)*100,m=k.popularQueries[j].query,g=this.category,h=this.color;d.each(this.septiles,function(i,p){if(l>p){l=i;return false}});d.each(this.data,function(i,p){if(i=="general"){return}if((p.list.indexOf(m)!==-1)){g=i;h=p.color;return false}});o.addClass(h);o.addClass(n);o.find(".name").text(m);o.attr("data-number",l);o.attr("data-category",g);this.container.append(o)}}})(window);